/* Formatted on 09/05/2022 17:23:54 (QP5 v5.256.13226.35510) */
  SELECT CIQT.ORGANIZATION_ID,
 
         MSI.description DESCRIPTION,
         MSI.PRIMARY_UOM_CODE UOM_CODE,
         ROUND (SUM (CIQT.ROLLBACK_QTY), 4) STK_QTY,
         0 INT_QTY,
         0 RCV_QTY,
           ROUND (
                SUM (CIQT.ROLLBACK_QTY)
              * DECODE (SUB.ASSET_INVENTORY, 1, CICT.ITEM_COST, 0)
              * 1
              / 0.0001)
         * 0.0001
            STK_VALUE,
         0 INT_VALUE,
         0 RCV_VALUE
    FROM XXXRME_CST_INV_QTY_TEMP CIQT,
         XXXRME_CST_INV_COST_TEMP CICT,
         MTL_PARAMETERS MP,
         MTL_SYSTEM_ITEMS_B MSI,
         apps.MTL_CATEGORIES MC,
         MTL_SECONDARY_INVENTORIES SUB
   WHERE     CIQT.QTY_SOURCE IN (3, 4, 5)
         AND CICT.COST_SOURCE IN (1, 2)
         AND CICT.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND CICT.INVENTORY_ITEM_ID = CIQT.INVENTORY_ITEM_ID
         AND (   MP.PRIMARY_COST_METHOD = 1
              OR CICT.COST_GROUP_ID = CIQT.COST_GROUP_ID)  -- should we split?
         AND MP.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND SUB.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND SUB.SECONDARY_INVENTORY_NAME = CIQT.SUBINVENTORY_CODE
         AND MSI.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND MSI.INVENTORY_ITEM_ID = CIQT.INVENTORY_ITEM_ID
         AND MC.CATEGORY_ID = CIQT.CATEGORY_ID
GROUP BY CIQT.ORGANIZATION_ID,
      
         MSI.description,
         MSI.PRIMARY_UOM_CODE,
         DECODE (SUB.ASSET_INVENTORY, 1, CICT.ITEM_COST, 0)
  HAVING SUM (CIQT.ROLLBACK_QTY) <> 0
UNION ALL
  SELECT CIQT.ORGANIZATION_ID,

         MSI.description DESCRIPTION,
         MSI.PRIMARY_UOM_CODE UOM_CODE,
         0 STK_QTY,
         ROUND (SUM (CIQT.ROLLBACK_QTY), 4) INT_QTY,
         0 RCV_QTY,
         0 STK_VALUE,
         ROUND (SUM (CIQT.ROLLBACK_QTY) * CICT.ITEM_COST * 1 / 0.0001) * 0.0001
            INT_VALUE,
         0 RCV_VALUE
    FROM XXXRME_CST_INV_QTY_TEMP CIQT,
         XXXRME_CST_INV_COST_TEMP CICT,
         MTL_PARAMETERS MP,
         MTL_SYSTEM_ITEMS_B MSI,
         apps.MTL_CATEGORIES MC
   WHERE     CIQT.QTY_SOURCE IN (6, 7, 8)
   --      AND CICT.ORGANIZATION_ID = NVL ( :P_ORG_ID, CICT.ORGANIZATION_ID)
         AND CICT.COST_SOURCE IN (1, 2)
         AND CICT.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND CICT.INVENTORY_ITEM_ID = CIQT.INVENTORY_ITEM_ID
         AND CICT.COST_GROUP_ID = CIQT.COST_GROUP_ID /*BUG 7138456: removed unnecesary join for the cost method*/
         AND MP.PRIMARY_COST_METHOD <> 1
         AND MP.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND MSI.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND MSI.INVENTORY_ITEM_ID = CIQT.INVENTORY_ITEM_ID
         AND MC.CATEGORY_ID = CIQT.CATEGORY_ID
GROUP BY CIQT.ORGANIZATION_ID,
       
         MSI.description,
         MSI.PRIMARY_UOM_CODE,
         CICT.ITEM_COST
  HAVING SUM (CIQT.ROLLBACK_QTY) <> 0
UNION ALL
  SELECT CIQT.ORGANIZATION_ID,
       
         MSI.description DESCRIPTION,
         MSI.PRIMARY_UOM_CODE UOM_CODE,
         0 STK_QTY,
         ROUND (SUM (CIQT.ROLLBACK_QTY), 4) INT_QTY,
         0 RCV_QTY,
         0 STK_VALUE,
         ROUND (SUM (CIQT.ROLLBACK_QTY) * CICT.ITEM_COST * 1 / 0.0001) * 0.0001
            INT_VALUE,
         0 RCV_VALUE
    FROM XXXRME_CST_INV_QTY_TEMP CIQT,
         XXXRME_CST_INV_COST_TEMP CICT,
         MTL_PARAMETERS MP,
         MTL_SYSTEM_ITEMS_B MSI,
         apps.MTL_CATEGORIES MC
   WHERE     CIQT.QTY_SOURCE IN (6, 7, 8)
   --     AND CICT.ORGANIZATION_ID = NVL ( :P_ORG_ID, CICT.ORGANIZATION_ID)
         AND CICT.COST_SOURCE IN (1, 2)
         AND CICT.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND CICT.INVENTORY_ITEM_ID = CIQT.INVENTORY_ITEM_ID
         AND MP.PRIMARY_COST_METHOD = 1
         AND MP.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND MSI.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND MSI.INVENTORY_ITEM_ID = CIQT.INVENTORY_ITEM_ID
         AND MC.CATEGORY_ID = CIQT.CATEGORY_ID
GROUP BY CIQT.ORGANIZATION_ID,
    
         MSI.description,
         MSI.PRIMARY_UOM_CODE,
         CICT.ITEM_COST
  HAVING SUM (CIQT.ROLLBACK_QTY) <> 0
UNION ALL
  SELECT CIQT.ORGANIZATION_ID,
  
         MSI.description DESCRIPTION,
         MSI.PRIMARY_UOM_CODE UOM_CODE,
         0 STK_QTY,
         0 INT_QTY,
         ROUND (SUM (CIQT.ROLLBACK_QTY), 4) RCV_QTY,
         0 STK_VALUE,
         0 INT_VALUE,
         ROUND (SUM (CIQT.ROLLBACK_QTY) * CICT.ITEM_COST * 1 / 0.0001) * 0.0001
            RCV_VALUE
    FROM XXXRME_CST_INV_QTY_TEMP CIQT,
         XXXRME_CST_INV_COST_TEMP CICT,
         MTL_SYSTEM_ITEMS_B MSI,
         apps.MTL_CATEGORIES MC
   WHERE     CIQT.QTY_SOURCE IN (9, 10)
         AND CICT.COST_SOURCE IN (3, 4)
         AND CICT.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND CICT.INVENTORY_ITEM_ID = CIQT.INVENTORY_ITEM_ID
         AND CICT.RCV_TRANSACTION_ID = CIQT.RCV_TRANSACTION_ID
         AND MSI.ORGANIZATION_ID = CIQT.ORGANIZATION_ID
         AND MSI.INVENTORY_ITEM_ID = CIQT.INVENTORY_ITEM_ID
         AND MC.CATEGORY_ID = CIQT.CATEGORY_ID
GROUP BY CIQT.ORGANIZATION_ID,
          MSI.description,
         MSI.PRIMARY_UOM_CODE,
         CICT.ITEM_COST
  HAVING SUM (CIQT.ROLLBACK_QTY) <> 0